{"version":3,"file":"vue.js","sources":["../../src/util/index.js","../../src/observer/array.js","../../src/observer/index.js","../../src/state.js","../../src/init.js","../../src/index.js"],"sourcesContent":["\nexport function isObject(data) {\n    // if (typeof data !== 'object' && data !== null) {\n    //     return true;\n    // }\n    return typeof data === 'object' && data !== null;\n}","// 重寫希望的數組中的部分方法\n\n\nlet oldArrayProto = Array.prototype; // 獲取數組的原型\nexport let newArrayProto = Object.create(oldArrayProto);\n\nlet methods = [ // 找到所有的變異方法\n    'push',\n    'pop',\n    'shift',\n    'unshift',\n    'reverse',\n    'sort',\n    'splice'\n]   // concat slice 都不會改變原數組\nmethods.forEach(method => {\n    newArrayProto[method] = function (...args) {    // 重寫數組方法\n        const result =\n            oldArrayProto[method].call(this, ...args)// 內部調用原來的方法 ， 切片編成\n        // 需要對新增的數組進行劫持\n        let inserted;\n        let ob = this.__ob__;\n        switch (method) {\n            case 'push':\n            case 'unshift':\n                inserted = args;\n                break;\n            case 'splice':\n                inserted = args.slice(2);\n            default:\n                break;\n        }\n        if (inserted) {\n            // 對新增的內容再次進行觀測\n            ob.observeArray(inserted);\n        }\n        // console.log('method', method)\n        return result;\n    }\n})\n\n","// 把data中的數據 都使用Object.defineProperty 重新定義 es5\n// Object.definProperty 不能兼容 ie8 及以下 vue2 不能兼容ie8以下\nimport { isObject } from '../util/index.js';\nimport { newArrayProto } from './array';\n\nclass Observer {\n    constructor(data) {\n        Object.defineProperty(data, '__ob__', {\n            value: this,\n            enumerable: false // 將__ob__變成不可枚舉()循環時無法獲取到\n        })\n        // data.__ob__ = this; // 給數據加了一個標示，如果數據上有__ob__則說明這個屬性被觀測過了\n        if (Array.isArray(data)) {\n            //這裡可以重寫數組中的方法 7個變異方法 是可以修改數組本身的\n            data.__proto__ = newArrayProto // 需要保留數組原有的特性，並且可以重寫部分方法\n            this.observeArray(data);        // 如果數組中放的是對象，可以監控到對象的變化\n\n        } else {\n            // vue 如果數據層次過多，需要遞歸的去解析對象中的屬性，依次增加set和get方法\n            this.walk(data);\n        }\n    }\n    walk(data) {\n        // let keys = Object.keys(data);\n        // keys.forEach((key, index) => {\n        //     defineReactive(data, key, data[key]);\n        // })\n        Object.keys(data).forEach(key => defineReactive(data, key, data[key]))\n    }\n    observeArray(data) { // 觀測數組\n        data.forEach(item => observe(item));\n    }\n}\n\nfunction defineReactive(data, key, value) {\n    observe(value); // 遞歸實現深度檢測\n    Object.defineProperty(data, key, {\n        get() {\n            return value;\n        },\n        set(newValue) {\n            if (newValue === value) return;\n            observe(newValue); // 繼續劫持用戶設置的值，因為有可能用戶設置是一個對象(新值若是全新的object 沒有設置會無法劫持)\n            value = newValue\n        }\n    })\n}\n\nexport function observe(data) {\n    let isObj = isObject(data);\n    if (!isObj) return;\n    if (data.__ob__ instanceof Observer) {  // 說明這個對象被代理過了\n        return data.__ob__;\n    }\n    // 如果對象被劫持過了，那就不需要再被劫持了\n    return new Observer(data); // 用來觀測數據\n}","import { observe } from './observer/index.js'\nexport function initState(vm) {\n    const opts = vm.$options;\n    // vue 的數據來源 屬性 方法 數據 計算屬性 watch\n    if (opts.props) {\n        initProps(vm);\n    }\n    if (opts.methods) {\n        initMethod(vm);\n    }\n    if (opts.data) {\n        initData(vm);\n    }\n    if (opts.computed) {\n        initComputed(vm);\n    }\n    if (opts.watch) {\n        initWatch(vm);\n    }\n}\nfunction initProps() { }\nfunction initMethod() { }\nfunction proxy(vm, target, key) {\n    Object.defineProperty(vm, key, {\n        get() {\n            return vm[target][key];\n        },\n        set(newValue) {\n            vm[target][key] = newValue;\n        }\n    })\n\n}\nfunction initData(vm) {\n    //數據初始化工作\n    let data = vm.$options.data;// 用戶傳遞的 data\n    data = vm._data = typeof data === 'function' ? data.call(vm) : data;\n    // 對象劫持 用戶改變了數據 希望能得到通知 => 刷新頁面\n    // MVVM 模式 數據變化驅動視圖變化 \n\n    // Object.defineProperty() 給屬性增加get 方法和set方法\n    observe(data);\n    // 將vm._data 用vm代理就可以了\n    for (let key in data) {\n        proxy(vm, '_data', key);\n    }\n}\nfunction initComputed() { }\nfunction initWatch() { } ","import { initState } from './state'\n// 在原型上添加一個 init 方法\nexport function initMixin(Vue) {\n    // 初始化流程\n    Vue.prototype._init = function (options) {\n        // 數據的劫持\n        const vm = this; // vue 中使用 this.$options 指代的就是用戶傳遞的屬性\n        vm.$options = options;\n        // 初始化狀態\n        initState(vm); // 分割代碼\n    }\n}","// Vue 核心代碼，只是 Vue 的一個聲明\nimport { initMixin } from './init';\nfunction Vue(options) {\n    //進行 Vue 的初始化操作\n    this._init(options);\n}\ninitMixin(Vue); // 給Vue原型上添加一個_init方法\nexport default Vue"],"names":["isObject","data","oldArrayProto","Array","prototype","newArrayProto","Object","create","methods","forEach","method","args","result","call","inserted","ob","__ob__","slice","observeArray","Observer","constructor","defineProperty","value","enumerable","isArray","__proto__","walk","keys","key","defineReactive","item","observe","get","set","newValue","isObj","initState","vm","opts","$options","props","initData","computed","watch","proxy","target","_data","initMixin","Vue","_init","options"],"mappings":"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"}